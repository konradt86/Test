# Definicja ścieżki do pliku Excela
$excelFilePath = "C:\Path\To\Your\File.xlsx"

# Tworzenie nowego obiektu aplikacji Excel
$excel = New-Object -ComObject Excel.Application

# Otworzenie pliku Excel
$workbook = $excel.Workbooks.Open($excelFilePath)

# Ustawienie widoczności Excela (opcjonalnie)
$excel.Visible = $false

# Odświeżanie wszystkich połączeń danych w arkuszu
foreach ($connection in $workbook.Connections) {
    $connection.Refresh()
}

# Czekanie, aż wszystkie odświeżenia się zakończą
while ($excel.BackgroundQuery) { Start-Sleep 1 }

# Zapisanie zmian w pliku
$workbook.Save()

# Zamknięcie pliku Excela
$workbook.Close()

# Wyłączenie aplikacji Excel
$excel.Quit()

# Zwalnianie zasobów COM
[System.Runtime.Interopservices.Marshal]::ReleaseComObject($excel) | Out-Null
[System.GC]::Collect()
[System.GC]::WaitForPendingFinalizers()
