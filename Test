Private Sub Workbook_Open()
    ThisWorkbook.RefreshAll
    Application.Wait (Now + TimeValue("0:02:00"))  ' Czeka 2 minuty na zakończenie odświeżania
    ThisWorkbook.Save
    Application.Quit
End Sub




# Ścieżka do pliku Excel
$filePath = "C:\ścieżka\do\pliku.xlsx"

# Uruchomienie Excela z plikiem
$excelProcess = Start-Process "EXCEL.EXE" $filePath -PassThru

# Czekaj na zakończenie procesu Excela (zamknięty przez VBA)
Wait-Process -Id $excelProcess.Id


import win32com.client as win32

def refresh_excel_file(file_path):
    # Otworzenie Excela
    excel = win32.Dispatch('Excel.Application')
    
    # Opcjonalnie, ustawienie Excela jako niewidoczny
    excel.Visible = False
    
    # Otworzenie pliku
    workbook = excel.Workbooks.Open(file_path)
    
    # Odświeżanie wszystkich połączeń danych
    for connection in workbook.Connections:
        connection.Refresh()
    
    # Zapisanie zmian w pliku
    workbook.Save()
    
    # Zamknięcie pliku
    workbook.Close()
    
    # Wyłączenie Excela
    excel.Quit()
    
    # Zwolnienie zasobów
    del excel

# Ścieżka do pliku Excel
file_path = r'C:\Path\To\Your\File.xlsx'

# Wywołanie funkcji
refresh_excel_file(file_path)
